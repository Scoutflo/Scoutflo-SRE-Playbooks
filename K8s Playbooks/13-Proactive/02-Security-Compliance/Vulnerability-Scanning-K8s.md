# Vulnerability Scanning

## Meaning

Vulnerability scanning indicates that security vulnerabilities are detected in container images, Kubernetes resources, or applications (triggering alerts like VulnerabilityDetected or SecurityVulnerabilityFound) because container image scans detect vulnerabilities, security audit findings identify security issues, vulnerability databases show known CVEs, security scans indicate compliance violations, or vulnerability scanning tools report vulnerabilities. Vulnerability scan results show detected vulnerabilities, security findings indicate high or critical severity issues, container image scans report vulnerabilities, and compliance checks indicate security violations. This affects the security layer and compliance posture, typically caused by unpatched software, vulnerable dependencies, misconfigured security settings, or outdated container images; if vulnerabilities affect container workloads, container images may contain vulnerabilities and applications may experience security risks.

## Impact

VulnerabilityDetected alerts fire; SecurityVulnerabilityFound alerts fire; security risks are identified; compliance violations are detected; container images contain vulnerabilities; security posture is degraded. Vulnerability scan results show detected vulnerabilities; if vulnerabilities affect container workloads, container images may contain vulnerabilities, pod security contexts may be misconfigured, and container applications may experience security risks; applications may experience security vulnerabilities or compliance violations.

## Playbook

1. List all pods in namespace <namespace> and retrieve their container image information to identify images requiring vulnerability scanning.
2. List recent events in namespace <namespace> sorted by timestamp to identify image pull failures, security policy violations, or scanning-related warnings.
3. Describe pod <pod-name> in namespace <namespace> to inspect the pod configuration and retrieve detailed container image information including image digests and pull policies.
4. List security audit findings in namespace `<namespace>` and filter for findings with severity 'HIGH' or 'CRITICAL' related to security vulnerabilities.
5. Retrieve container image scan results for image `<image-uri>` and inspect vulnerability findings including severity levels and CVE identifiers, verifying scan completion status.
6. Retrieve logs from vulnerability scanning pods in namespace `<namespace>` and filter for vulnerability detection patterns within the last 7 days.
7. Retrieve Prometheus metrics for vulnerability scanning service including finding_count and finding_severity over the last 7 days to identify vulnerability detection trends.
8. Compare vulnerability detection timestamps with container image push timestamps and verify whether vulnerabilities are introduced with new image versions, using container image scan results as supporting evidence.
9. Retrieve the container registry `<registry-name>` image scan configuration and verify whether automatic scanning is enabled, checking image scan automation.

## Diagnosis

1. Review the security audit findings from Step 4. If HIGH or CRITICAL vulnerabilities are present, these require immediate remediation. Prioritize based on exploitability and exposure of affected containers.

2. Analyze the container image scan results from Step 5. If specific images have high vulnerability counts, identify whether these are base image issues (requiring base image updates) or application dependency issues (requiring dependency updates).

3. If Step 7 scanning metrics show increasing finding counts over time, then new vulnerabilities are being introduced faster than remediation. If counts are stable or decreasing, then vulnerability management processes are effective.

4. Review the image push correlation from Step 8. If vulnerabilities are consistently introduced with new image versions, then CI/CD pipeline scanning needs strengthening. If vulnerabilities appear in unchanged images, then vulnerability database updates are detecting previously unknown issues.

5. If Step 9 automatic scanning shows disabled status, then images may not be scanned at push time. Enable automatic scanning to catch vulnerabilities before deployment.

If analysis is inconclusive: Examine events from Step 2 for image pull failures or security policy violations that may indicate blocked vulnerable images. Review the scanning pod logs from Step 6 for detection patterns. Determine whether vulnerabilities are concentrated in specific images (suggesting image-specific issues) or distributed across many images (suggesting base image or dependency issues).
