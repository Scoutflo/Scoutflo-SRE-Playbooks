# Vulnerability Scanning

## Meaning

Vulnerability scanning indicates that security vulnerabilities are detected in AWS resources, container images, or applications (triggering alarms like VulnerabilityDetected or SecurityVulnerabilityFound) because ECR image scans detect vulnerabilities, Inspector findings identify security issues, Security Hub findings report vulnerabilities, vulnerability databases show known CVEs, or security scans indicate compliance violations. Vulnerability scan results show detected vulnerabilities, security findings indicate high or critical severity issues, container image scans report vulnerabilities, and compliance checks indicate security violations. This affects the security layer and compliance posture, typically caused by unpatched software, vulnerable dependencies, misconfigured security settings, or outdated container images; if vulnerabilities affect container workloads, container images may contain vulnerabilities and applications may experience security risks.

## Impact

VulnerabilityDetected alarms fire; SecurityVulnerabilityFound alarms fire; security risks are identified; compliance violations are detected; container images contain vulnerabilities; security posture is degraded. Vulnerability scan results show detected vulnerabilities; if vulnerabilities affect container workloads, container images may contain vulnerabilities, pod security contexts may be misconfigured, and container applications may experience security risks; applications may experience security vulnerabilities or compliance violations.

## Playbook

1. List ECR repositories in region `<region>` and retrieve ECR image scan findings to identify images with detected vulnerabilities.
2. Retrieve ECR image scan results for image `<image-uri>` and inspect vulnerability findings including severity levels and CVE identifiers, verifying scan completion status.
3. List Inspector findings in region `<region>` and filter for findings with severity 'HIGH' or 'CRITICAL' related to security vulnerabilities.
4. Retrieve Security Hub findings in region `<region>` and filter for findings with severity 'HIGH' or 'CRITICAL' related to vulnerability detections.
5. Query CloudWatch Logs for log groups containing Inspector or Security Hub events and filter for vulnerability detection patterns within the last 7 days.
6. Retrieve CloudWatch metrics for Inspector service including FindingCount and FindingSeverity over the last 7 days to identify vulnerability detection trends.
7. Compare vulnerability detection timestamps with container image push timestamps and verify whether vulnerabilities are introduced with new image versions, using ECR image scan results as supporting evidence.
8. Retrieve the ECR repository `<repository-name>` image scan configuration and verify whether automatic scanning is enabled, checking image scan automation.

## Diagnosis

1. **Analyze ECR scan findings from Step 1 and Step 2**: If CRITICAL vulnerabilities are detected, prioritize remediation. If vulnerabilities have fixes available (check CVE details), update the affected packages. If vulnerabilities are in base images, update to patched base image versions.

2. **Evaluate Inspector findings from Step 3**: If findings identify EC2 instance vulnerabilities, patch the operating system. If findings identify network configuration issues, review security groups and NACLs. If findings are for Lambda functions, update runtime or dependencies.

3. **Review Security Hub aggregated findings from Step 4**: If multiple services show similar vulnerabilities, a common dependency is affected. If findings are increasing over time from Step 6, scanning coverage is improving or new vulnerabilities are being introduced.

4. **Cross-reference with image push events from Step 7**: If vulnerabilities appear after specific image pushes, that image version introduced the vulnerability. If vulnerabilities exist in all image versions, the base image or persistent dependency is the source.

5. **Assess scan automation from Step 8**: If automatic scanning is disabled, vulnerabilities may exist undetected. If scanning is enabled but findings are old, new images are not being scanned. If scanning is enabled and current, the vulnerability detection is working correctly.

If the above analysis is inconclusive: Review CVE databases for vulnerability details and remediation guidance. Check if vulnerabilities are exploitable in your environment context. Verify compensating controls that may mitigate vulnerability risk. Consider vulnerability exceptions for false positives or accepted risks.
